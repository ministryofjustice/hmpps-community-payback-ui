{% extends "../partials/layout.njk" %}

{% from "govuk/components/select/macro.njk" import govukSelect %}
{% from "govuk/components/date-input/macro.njk" import govukDateInput %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "../showErrorSummary.njk" import showErrorSummary %}

{% set pageTitle = applicationName + " - Track progress on Community Payback" %}
{% set mainClasses = "app-container govuk-body" %}

{% block content %}

  {{ showErrorSummary(errorSummary) }}

  <h1>Track progress on Community Payback</h1>
  <h2 class="govuk-heading-m">Find a session</h2>
    <div class="search-and-filter" data-module="cpb-team-filter">
      {% if providerItems %}
        <form action="{{ paths.sessions.index() }}" id="filter-provider-no-js" method="get" class="govuk-!-margin-bottom-5">
          <div class="search-and-filter__row">
            {{ govukSelect({
              label: {
                  text: "Region",
                  classes: "govuk-label--s"
              },
              id: "provider",
              name: "provider",
              items: providerItems
            }) }}
            {{ govukButton({
              "text": "Apply",
              preventDoubleClick: true
            }) }}
          </div>
        </form>
      {% endif %}
      <form action="{{ paths.sessions.search() }}" method="get">
        {% if provider %}
          <label class="govuk-label govuk-label--s">Region</label>
          <p class="govuk-body">{{ provider.name }}</p>
        {% endif %}
          <div class="search-and-filter__row" id="filter-team-row">
          <input type="hidden" name="provider" value="{{ providerCode }}" />
            {{ govukSelect({
              label: {
                  text: "Team",
                  classes: "govuk-label--s"
              },
              id: "team",
              name: "team",
              items: teamItems,
              errorMessage: errors.team,
              disabled: providerCode == '' or providerCode == undefined
            }) }}
          </div>
        <div class="search-and-filter__row">
          {{ govukDateInput({
            id: "startDate",
            namePrefix: "startDate",
            fieldset: {
              legend: {
                text: "From",
                classes: "govuk-!-font-weight-bold"
              }
            },
            items: startDateItems,
            errorMessage: errors['startDate-day']
          }) }}
          {{ govukDateInput({
            id: "endDate",
            namePrefix: "endDate",
            fieldset: {
              legend: {
                text: "To",
                classes: "govuk-!-font-weight-bold"
              }
            },
            items: endDateItems,
            errorMessage: errors['endDate-day']
          }) }}
          {{ govukButton({
            "name": "submit",
            "text": "Search",
            preventDoubleClick: true
          }) }}
        </div>
      </form>
    </div>

  {% if showNoResultsMessage %}
    <h2>No results found</h2>

    <p>There are no results that match your search. Try searching again using different search criteria.</p>
  {% endif %}

  {% if sessionRows | length %}
    {% include "./_table.njk" %}
  {% endif %}

  <template id="filter-provider-team-js">
      
    {{ govukSelect({
        label: {
            text: "Region",
            classes: "govuk-label--s"
        },
        id: "provider",
        name: "provider",
        items: providerItems
        }) }}

    {{ govukSelect({
        label: {
            text: "Team",
            classes: "govuk-label--s"
        },
        id: "team",
        name: "team",
        items: teamItems,
        errorMessage: errors.team,
        disabled: providerCode == '' or providerCode == undefined
    }) }}

  </template>

{% endblock %}
